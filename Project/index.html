<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">
	<script type = "text/javascript" src = "getdata.html"></script>
	<title>DVP Home</title>
	<style>
		body {
align-content: center;
			font-family: Poppins;
			background-size: cover;
background-image: url("https://www.cicnews.com/wp-content/uploads/2021/05/20210528vaccinepassports.jpg");

background-repeat: no-repeat;

		}

		div {
			display: flex;

			flex-direction: column;
		}

		input {
			background-color: rgba(255, 255, 255, 0.842);
			box-sizing: border-box;
			padding: 10px;
			border: 0;
			box-shadow: 0 0 15px 4px rgba(0, 0, 0, 0.06);
			border-radius: 5px;
			border: none;
			padding-left: 20px;
			margin: 20px 10px;
			outline: none;
		}

		button {
			
			/* Green */
			background-color: rgb(17, 151, 28);
		
			font-family: Poppins;
			border: none;
			color: white;
			padding: 15px 32px;
			margin: 10px 10px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			font-size: 16px;
			border-radius: 5px;
		}

		button:hover {
			background-color: green;
		}
		.intro{
			float:left;
			font-size: 30px;
			width: 40%;
			margin-left:100px;
			margin-top: 230px;
		
		}

		.form {
			color: white;
			font-family: Poppins;
			margin-top: 20px;
			margin-right: 20px;
			background-color: rgba(67, 70, 67, 0.671);
			border-radius: 20px;
			padding: 5px 25px;width: 30%;

float: right;
		}
		strong{
			color: green;
			font-size:60px;
		}
		.select{
			text-align:left;
			text-decoration: none;
			font-family: Poppins;
			outline: none;
			color: grey;
			
float: right;
width: 95%;
padding: 5px;
padding-left: 15px;
height: 35px;
margin-top: 20px;
margin-right: 10px;
margin-bottom: 20px;
border-radius: 5px;
background-color: rgba(255, 255, 255, 0.781);
color: black;
border: none;

		}
		option{
			font-family: Poppins;
			padding: 80px;
			color: grey;
		}

	
		
		.selectdiv{
			display: inline;
		}
	</style>

</head>

<body>
	<div class="intro">
		<h3>DIGITAL VACCINE <br><strong>PASSPORT</strong></h3>
		
	</div>
	<div class="form">

		<p>Here we can set or get the Vaccine Data:</p>

		<input type="text" id="Address" placeholder="Address"/>
		<input type="text" id="Name" placeholder="Name" />
		<input type="text" id="Adhaar" placeholder="Aadhar Number" />
		<div class="selectdiv"><select id = "Vaccine" class="select">  
			<option>**Vaccine name**</option>
			<option> Covaxin</option>  
			<option> CoviShield </option>  
			<option> Sputnik </option>  
			<option> Pfizer </option>  
			</select>  </div>
		<button onclick="redirect()"formtarget="_blank" >Get Data</button>
		<button onclick="setData()">Add Data</button>
	</div>
	



	<script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>
    <script type="text/javascript" src="scr.js"></script>
	<script>
         /*document.addEventListener("click", function(e) {
            if (e.target.id == "getdata" &&
                    !e.target.hasAttribute("target"))
            {
                console.log("hello");
                e.target.setAttribute("target", "_blank");
            }
        });*/
		const provider = new ethers.providers.Web3Provider(window.ethereum, "ropsten");

		const MoodContractAddress = "Smart contract address";
		const MoodContractABI = [
			{
				"inputs": [
					{
						"internalType": "string",
						"name": "Patient",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "Name",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "Adhaar_Number",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "Vaccine",
						"type": "string"
					}
				],
				"name": "addToBlockChain",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": false,
						"internalType": "address",
						"name": "FrontLineWorker",
						"type": "address"
					},
					{
						"indexed": false,
						"internalType": "string",
						"name": "Patient",
						"type": "string"
					},
					{
						"indexed": false,
						"internalType": "string",
						"name": "Name",
						"type": "string"
					},
					{
						"indexed": false,
						"internalType": "string",
						"name": "Adhaar_Number",
						"type": "string"
					},
					{
						"indexed": false,
						"internalType": "string",
						"name": "Vaccine",
						"type": "string"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "Time_stamp",
						"type": "uint256"
					}
				],
				"name": "Enter",
				"type": "event"
			},
			{
				"inputs": [],
				"name": "getAllPatientData",
				"outputs": [
					{
						"components": [
							{
								"internalType": "address",
								"name": "FrontLineWorker",
								"type": "address"
							},
							{
								"internalType": "string",
								"name": "Patient",
								"type": "string"
							},
							{
								"internalType": "string",
								"name": "Name",
								"type": "string"
							},
							{
								"internalType": "string",
								"name": "Adhaar_Number",
								"type": "string"
							},
							{
								"internalType": "string",
								"name": "Vaccine",
								"type": "string"
							},
							{
								"internalType": "uint256",
								"name": "Time_stamp",
								"type": "uint256"
							}
						],
						"internalType": "struct Covid_Project.Patient_Data[]",
						"name": "",
						"type": "tuple[]"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "getEnteriesCount",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			}
		]
		let MoodContract;
		let signer;

		provider.send("eth_requestAccounts", []).then(() => {
			provider.listAccounts().then((accounts) => {
				signer = provider.getSigner(accounts[0]);
				MoodContract = new ethers.Contract(
					MoodContractAddress,
					MoodContractABI,
					signer
				);
                sessionStorage.setItem("MoodCon",MoodContract);
			});
		});
        function redirect()
        {
            window.open('getdata.html');
        }
		/*async function getData() {
			const getMoodPromise = MoodContract.getAllPatientData();
			const Mood = await getMoodPromise;
			
			console.log(Mood);
			sessionStorage.setItem('TheArray',JSON.stringify(Mood));
            
			window.open('getdata.html')
		}*/

		async function setData() {
			const address = document.getElementById("Address").value;
			const name = document.getElementById("Name").value;
			const adhaar = document.getElementById("Adhaar").value;
			const vaccine = document.getElementById("Vaccine").value;
			const setMoodPromise = MoodContract.addToBlockChain(address, name, adhaar, vaccine);
			await setMoodPromise;
		}
	</script>
<script type="module">
	// Import the functions you need from the SDKs you need
	import { initializeApp } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-app.js";
  import { getDatabase, set, ref, update } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-database.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-auth.js";
	// TODO: Add SDKs for Firebase products that you want to use
	// https://firebase.google.com/docs/web/setup#available-libraries

	// Your web app's Firebase configuration
	const firebaseConfig = {};
  
	// Initialize Firebase
	const app = initializeApp(firebaseConfig);
	const database=getDatabase(app);
	const auth=getAuth();
	console.log(app.name);
	const user = auth.currentUser;
	onAuthStateChanged(auth, (user) => {
	if (user) {
		// User is signed in, see docs for a list of available properties
		// https://firebase.google.com/docs/reference/js/firebase.User
		var uid = user.uid;
		// ...
	} 
	else{
		location.replace("hcplp.html");
	} 
	});
</script>
</body>

</html>